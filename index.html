<!DOCTYPE html>
<html lang="zh-CN">
<head>
  <meta charset="UTF-8">
<meta name="viewport" content="width=device-width, initial-scale=1, maximum-scale=2">
<meta name="theme-color" content="#222">
<meta name="generator" content="Hexo 6.3.0">
  <link rel="apple-touch-icon" sizes="180x180" href="/images/apple-touch-icon-next.png">
  <link rel="icon" type="image/png" sizes="32x32" href="/images/favicon-32x32-next.png">
  <link rel="icon" type="image/png" sizes="16x16" href="/images/favicon-16x16-next.png">
  <link rel="mask-icon" href="/images/logo.svg" color="#222">

<link rel="stylesheet" href="/css/main.css">


<link rel="stylesheet" href="/lib/font-awesome/css/all.min.css">

<script id="hexo-configurations">
    var NexT = window.NexT || {};
    var CONFIG = {"hostname":"github.com","root":"/","scheme":"Muse","version":"7.8.0","exturl":false,"sidebar":{"position":"left","display":"post","padding":18,"offset":12,"onmobile":false},"copycode":{"enable":false,"show_result":false,"style":null},"back2top":{"enable":true,"sidebar":false,"scrollpercent":false},"bookmark":{"enable":false,"color":"#222","save":"auto"},"fancybox":false,"mediumzoom":false,"lazyload":false,"pangu":false,"comments":{"style":"tabs","active":null,"storage":true,"lazyload":false,"nav":null},"algolia":{"hits":{"per_page":10},"labels":{"input_placeholder":"Search for Posts","hits_empty":"We didn't find any results for the search: ${query}","hits_stats":"${hits} results found in ${time} ms"}},"localsearch":{"enable":false,"trigger":"auto","top_n_per_article":1,"unescape":false,"preload":false},"motion":{"enable":true,"async":false,"transition":{"post_block":"fadeIn","post_header":"slideDownIn","post_body":"slideDownIn","coll_header":"slideLeftIn","sidebar":"slideUpIn"}}};
  </script>

  <meta property="og:type" content="website">
<meta property="og:title" content="blog of dz">
<meta property="og:url" content="http://github.com/index.html">
<meta property="og:site_name" content="blog of dz">
<meta property="og:locale" content="zh_CN">
<meta property="article:author" content="dz">
<meta name="twitter:card" content="summary">

<link rel="canonical" href="http://github.com/">


<script id="page-configurations">
  // https://hexo.io/docs/variables.html
  CONFIG.page = {
    sidebar: "",
    isHome : true,
    isPost : false,
    lang   : 'zh-CN'
  };
</script>

  <title>blog of dz</title>
  






  <noscript>
  <style>
  .use-motion .brand,
  .use-motion .menu-item,
  .sidebar-inner,
  .use-motion .post-block,
  .use-motion .pagination,
  .use-motion .comments,
  .use-motion .post-header,
  .use-motion .post-body,
  .use-motion .collection-header { opacity: initial; }

  .use-motion .site-title,
  .use-motion .site-subtitle {
    opacity: initial;
    top: initial;
  }

  .use-motion .logo-line-before i { left: initial; }
  .use-motion .logo-line-after i { right: initial; }
  </style>
</noscript>

</head>

<body itemscope itemtype="http://schema.org/WebPage">
  <div class="container use-motion">
    <div class="headband"></div>

    <header class="header" itemscope itemtype="http://schema.org/WPHeader">
      <div class="header-inner"><div class="site-brand-container">
  <div class="site-nav-toggle">
    <div class="toggle" aria-label="切换导航栏">
      <span class="toggle-line toggle-line-first"></span>
      <span class="toggle-line toggle-line-middle"></span>
      <span class="toggle-line toggle-line-last"></span>
    </div>
  </div>

  <div class="site-meta">

    <a href="/" class="brand" rel="start">
      <span class="logo-line-before"><i></i></span>
      <h1 class="site-title">blog of dz</h1>
      <span class="logo-line-after"><i></i></span>
    </a>
  </div>

  <div class="site-nav-right">
    <div class="toggle popup-trigger">
    </div>
  </div>
</div>




<nav class="site-nav">
  <ul id="menu" class="main-menu menu">
        <li class="menu-item menu-item-home">

    <a href="/" rel="section"><i class="fa fa-home fa-fw"></i>首页</a>

  </li>
        <li class="menu-item menu-item-archives">

    <a href="/archives/" rel="section"><i class="fa fa-archive fa-fw"></i>归档</a>

  </li>
  </ul>
</nav>




</div>
    </header>

    
  <div class="back-to-top">
    <i class="fa fa-arrow-up"></i>
    <span>0%</span>
  </div>


    <main class="main">
      <div class="main-inner">
        <div class="content-wrap">
          

          <div class="content index posts-expand">
            
      
  
  
  <article itemscope itemtype="http://schema.org/Article" class="post-block" lang="zh-CN">
    <link itemprop="mainEntityOfPage" href="http://github.com/2024/03/08/android12%E5%90%AF%E5%8A%A8%E6%B5%81%E7%A8%8B/">

    <span hidden itemprop="author" itemscope itemtype="http://schema.org/Person">
      <meta itemprop="image" content="/images/avatar.gif">
      <meta itemprop="name" content="dz">
      <meta itemprop="description" content="">
    </span>

    <span hidden itemprop="publisher" itemscope itemtype="http://schema.org/Organization">
      <meta itemprop="name" content="blog of dz">
    </span>
      <header class="post-header">
        <h2 class="post-title" itemprop="name headline">
          
            <a href="/2024/03/08/android12%E5%90%AF%E5%8A%A8%E6%B5%81%E7%A8%8B/" class="post-title-link" itemprop="url">android12启动流程</a>
        </h2>

        <div class="post-meta">
            <span class="post-meta-item">
              <span class="post-meta-item-icon">
                <i class="far fa-calendar"></i>
              </span>
              <span class="post-meta-item-text">发表于</span>
              

              <time title="创建时间：2024-03-08 09:31:03 / 修改时间：10:41:11" itemprop="dateCreated datePublished" datetime="2024-03-08T09:31:03+08:00">2024-03-08</time>
            </span>

          

        </div>
      </header>

    
    
    
    <div class="post-body" itemprop="articleBody">

      
          <h1 id="android12系统启动流程"><a href="#android12系统启动流程" class="headerlink" title="android12系统启动流程"></a>android12系统启动流程</h1><h2 id="1-启动流程概述"><a href="#1-启动流程概述" class="headerlink" title="1.启动流程概述"></a>1.启动流程概述</h2><h4 id="1-1-Bootloader引导"><a href="#1-1-Bootloader引导" class="headerlink" title="1.1 Bootloader引导"></a>1.1 Bootloader引导</h4><p>当按下设备电源键时，最先运行的就是 bootloader（固化在ROM的程序），bootloader 的主要作用就是硬件设备（如 CPU、flash、内存）的初始化并加载到RAM，通过建立内存空间映射，为装载 Linux 内核做好准备,。如果 bootloader 在运行期间，按下预定义的组合按键，可以进入系统fastboot模式 或者 Receiver 模式。</p>
<h4 id="1-2-装载和启动Linux内核"><a href="#1-2-装载和启动Linux内核" class="headerlink" title="1.2 装载和启动Linux内核"></a>1.2 装载和启动Linux内核</h4><p>在编译完AOSP时会生成boot.img或者boot_debug.img，该镜像就是 Linux 内核和根文件系统，bootloader 会把该镜像装载到内存中，然后 linux 内核会执行整个系统的初始化，完成后装载根文件系统，最后启动 init 进程。</p>
<h4 id="1-3-启动Init进程"><a href="#1-3-启动Init进程" class="headerlink" title="1.3 启动Init进程"></a>1.3 启动Init进程</h4><p>Linux内核加载完毕后，会首先启动Init进程，Init进程是系统的第一个 进程。在Init进程的启动过程中，会解析Linux的配置脚本init.rc文件。根 据init.rc文件的内容，Init进程会装载Android的文件系统、创建系统目 录、初始化属性系统、启动Android系统重要的守护进程，这些进程包括USB 守护进程、adb守护进程、vold守护进程、rild守护进程等。 最后Init进程也会作为守护进程来执行修改属性请求，重启崩溃的进程等操作</p>
<h4 id="1-4-启动ServiceManager"><a href="#1-4-启动ServiceManager" class="headerlink" title="1.4 启动ServiceManager"></a>1.4 启动ServiceManager</h4><p>ServiceManager 由 init 进程启动。它的主要作用是管理 Binder 服务，service 服务的注册和查找，如 AMS、PMS， 都是通过 ServiceManger 来管理。</p>
<h4 id="1-5-启动MediaServer"><a href="#1-5-启动MediaServer" class="headerlink" title="1.5 启动MediaServer"></a>1.5 <strong>启动MediaServer</strong></h4><p>MediaServer 是由 init 进程启动，它包含了一些多媒体 binder 服务，包括 CameraService、MediaPlayerService、AudioPolicyService 等等</p>
<h4 id="1-6启动-Zygote-进程"><a href="#1-6启动-Zygote-进程" class="headerlink" title="1.6启动 Zygote 进程"></a>1.6<strong>启动 Zygote 进程</strong></h4><p>init 进程初始化结束后，会启动 Zygote 进程。在 Android 系统中所有的应用程序进程和系统服务进程都是通过Zygote 进程 fork 出来的。预装载系统的资源文件，所有从 Zygote 进程 fork 出的子进程都会共享这些资源，节省了资源加载的时间，提高的应用的启动速度。Zygote 启动结束后也会变为守护进程，负责响应启动 APK 的请求。</p>
<h4 id="1-7-启动SystemServer"><a href="#1-7-启动SystemServer" class="headerlink" title="1.7 启动SystemServer"></a>1.7 启动SystemServer</h4><p>SystemServer 是 Zygote 进程 fork 出的第一个进程，也是整个 Android 系统的核心进程。在SystemServer中运行着Android系统大部分的 Binder服务。SystemServer首先启动本地服务Sensor Service；接着启动包 括 ActivityManagerService、WindowsMangerService、 PackageManagerService在内的所有Java服务。</p>
<h4 id="1-8-启动Launcher"><a href="#1-8-启动Launcher" class="headerlink" title="1.8 启动Launcher"></a>1.8 启动Launcher</h4><p>SystemServer加载完所有Java服务后，最后会调用 ActivityManagerService的SystemReady()方法。在这个方法的执行中，会发 出Intent“android.intent.category.HOME”。凡是响应这个Intent的apk应 用都会运行起来，Launcher应用是Android系统默认的桌面应用，一般只有它 会响应这个Intent，因此，系统开机后，第一个运行的应用就是Launcher。</p>
<p><img src="/images/android12-init-progress-1.jpg" alt="启动流程概图"></p>

      
    </div>

    
    
    
      <footer class="post-footer">
        <div class="post-eof"></div>
      </footer>
  </article>
  
  
  

      
  
  
  <article itemscope itemtype="http://schema.org/Article" class="post-block" lang="zh-CN">
    <link itemprop="mainEntityOfPage" href="http://github.com/2024/03/04/android%E7%B3%BB%E7%BB%9F%E8%B0%83%E7%A0%94/">

    <span hidden itemprop="author" itemscope itemtype="http://schema.org/Person">
      <meta itemprop="image" content="/images/avatar.gif">
      <meta itemprop="name" content="dz">
      <meta itemprop="description" content="">
    </span>

    <span hidden itemprop="publisher" itemscope itemtype="http://schema.org/Organization">
      <meta itemprop="name" content="blog of dz">
    </span>
      <header class="post-header">
        <h2 class="post-title" itemprop="name headline">
          
            <a href="/2024/03/04/android%E7%B3%BB%E7%BB%9F%E8%B0%83%E7%A0%94/" class="post-title-link" itemprop="url">android系统调研</a>
        </h2>

        <div class="post-meta">
            <span class="post-meta-item">
              <span class="post-meta-item-icon">
                <i class="far fa-calendar"></i>
              </span>
              <span class="post-meta-item-text">发表于</span>

              <time title="创建时间：2024-03-04 14:22:40" itemprop="dateCreated datePublished" datetime="2024-03-04T14:22:40+08:00">2024-03-04</time>
            </span>
              <span class="post-meta-item">
                <span class="post-meta-item-icon">
                  <i class="far fa-calendar-check"></i>
                </span>
                <span class="post-meta-item-text">更新于</span>
                <time title="修改时间：2024-03-06 20:35:17" itemprop="dateModified" datetime="2024-03-06T20:35:17+08:00">2024-03-06</time>
              </span>

          

        </div>
      </header>

    
    
    
    <div class="post-body" itemprop="articleBody">

      
          <h1 id="ANDROID系统调研"><a href="#ANDROID系统调研" class="headerlink" title="ANDROID系统调研"></a>ANDROID系统调研</h1><h4 id="概要"><a href="#概要" class="headerlink" title="概要"></a>概要</h4><p>由于AOSP以及官方文档较多，除第一部分AOSP框架以外，现选取ART、Bionic以及JNI作为主要的调研对象。性能分析工具后续计划补充。</p>
<h2 id="1-AOSP架构"><a href="#1-AOSP架构" class="headerlink" title="1.AOSP架构"></a>1.AOSP架构</h2><p><img src="https://source.android.google.cn/static/images/android_stack.png?hl=zh-cn" alt="AOSP 软件堆栈架构。"></p>
<p>其中，自上而下分别是：</p>
<p>*Android Apps:*完全使用 Android API 开发的应用</p>
<p>Priviledged Apps:使用 Android 和系统 API 组合创建的应用，需要作为特权应用预安装在设备上</p>
<p>Device Manufacture Apps:结合使用 Android API、系统 API 并直接访问 Android 框架实现而创建的应用</p>
<p>System API:系统 API 表示仅供合作伙伴和 OEM 纳入捆绑应用的 Android API</p>
<p>Android API:Android API 是面向第三方 Android 应用开发者的公开 API</p>
<p>Android Framework:构建应用所依据的一组 Java 类、接口和其他预编译代码。框架的某些部分可通过使用 Android API 公开访问。框架的其他部分只能由 OEM 通过系统 API 来访问。Android 框架代码在应用进程内运行。</p>
<p>System Service:系统服务是重点突出的模块化组件，例如 <code>system_server</code>、SurfaceFlinger 和 MediaService。Android 框架 API 提供的功能可以与系统服务进行通信，以访问底层硬件。</p>
<p>ART:AOSP 提供的 Java 运行时环境。 ART 会将应用的字节码转换为由设备运行时环境执行的处理器专有指令。</p>
<p>Hardware abstration layer(HAL):HAL 是一个抽象层，其中包含硬件供应商要实现的标准接口</p>
<p>Native daemons and libraries:该层中的原生守护程序包括 <code>init</code>、<code>healthd</code>、<code>logd</code> 和 <code>storaged</code>。这些守护程序直接与内核或其他接口进行交互，并且不依赖于基于用户空间的 HAL 实现。该层中的原生库包括 <code>libc</code>、<code>liblog</code>、<code>libutils</code>、<code>libbinder</code> 和 <code>libselinux</code>。这些原生库直接与内核或其他接口进行交互，并且不依赖于基于用户空间的 HAL 实现。</p>
<p>Kernel:内核是任何操作系统的中心部分，并与设备上的底层硬件进行通信</p>
<h2 id="2-ART"><a href="#2-ART" class="headerlink" title="2.ART"></a>2.ART</h2><p><strong>A</strong>ndroid <strong>R</strong>un<strong>t</strong>ime（ART）是安卓上一些应用和系统服务的运行环境。</p>
<h3 id="2-1-JVM、DVM分析比较"><a href="#2-1-JVM、DVM分析比较" class="headerlink" title="2.1 JVM、DVM分析比较"></a>2.1 JVM、DVM分析比较</h3><p>ART的前身是Dalvik，传统的Dalvik其实就是一个java虚拟机。而google没有采用JVM不仅仅是因为版权的问题，DVM和JVM在技术细节上有许多不同之处。</p>
<table>
<thead>
<tr>
<th align="center">不同点</th>
<th align="center">DVM</th>
<th align="center">JVM</th>
</tr>
</thead>
<tbody><tr>
<td align="center">执行的字节码不同</td>
<td align="center">DVM执行的是.dex格式文件</td>
<td align="center">JVM执行的是.class文件</td>
</tr>
<tr>
<td align="center">基于的架构不同</td>
<td align="center">基于寄存器</td>
<td align="center">基于虚拟栈</td>
</tr>
<tr>
<td align="center">GC实现</td>
<td align="center">单独申请一块空间，以位图的形式保存堆上的对象的标记</td>
<td align="center">对象开头的地方留一小块空间</td>
</tr>
</tbody></table>
<p><strong>执行的字节码不同</strong></p>
<p>在Java SE程序中，Java类会被编译成一个或多个.class文件，打包成jar文件，然后JVM会通过相应的.class文件和jar文件获取相应的字节码。</p>
<p>执行顺序为： .java -&gt; .class -&gt; .jar</p>
<p>而DVM会用dx工具将所有的.class文件转换为一个.dex文件，然后DVM会从.dex文件读取指令和数据。</p>
<p>执行顺序为： .java -&gt; .class -&gt; .dex</p>
<p><img src="https://s2.ax1x.com/2019/05/31/VQviBn.png" alt="VQviBn.png"></p>
<p>如图所示，.jar文件包含多个.class文件，每个.class文件包含了类的常量池、方法、属性等，因此JVM在加载jar文件的时候，会加载所有的.class文件，这种加载方式很慢，不适用于移动设备。</p>
<p>而.dex文件将所有.class文件的信息整合在一起，并且通过去除.class文件中的冗余信息，减少了I&#x2F;O操作，提升了类的查找速度。</p>
<p><strong>基于的架构不同</strong></p>
<p>JVM基于栈则意味着需要去栈中读写数据，所需的指令会更多，这样会导致速度慢，对于性能有限的移动设备，显然不是很适合。</p>
<p>DVM是基于寄存器的，它没有基于栈的虚拟机在拷贝数据而使用的大量的出入栈指令，同时指令更紧凑更简洁。但是由于显示指定了操作数，所以基于寄存器的指令会比基于栈的指令要大，但是由于指令数量的减少，总的代码数不会增加多少。</p>
<h3 id="2-2-ART执行方式"><a href="#2-2-ART执行方式" class="headerlink" title="2.2  ART执行方式"></a>2.2  ART执行方式</h3><p><img src="https://source.android.google.cn/docs/core/runtime/images/jit-arch.png?hl=zh-cn" alt="JIT 架构"></p>
<p>Android Runtime (ART) 包含一个具备代码分析功能的即时 (JIT) 编译器，该编译器可以在 Android  应用运行时持续提高其性能。JIT 编译器对 Android 运行组件当前的预先 (AOT)  编译器进行了补充，可以提升运行时性能，节省存储空间，加快应用和系统更新速度。相较于 AOT 编译器，JIT  编译器的优势也更为明显，因为在应用自动更新期间或在无线下载 (OTA) 更新期间重新编译应用时，它不会拖慢系统速度。</p>
<p>尽管 JIT 和 AOT 使用相同的编译器，它们所进行的一系列优化也较为相似，但它们生成的代码可能会有所不同。JIT 会利用运行时类型信息，可以更高效地进行内联，并可让堆栈替换 (OSR) 编译成为可能，而这一切都会使其生成的代码略有不同。</p>
<p>Android早期是aot的方式先编译成机器码，然后再运行的，这样会导致安装时间变长，后面的版本改成jit编译方式，在运行时编译，这样会导致运行速度较慢。android7.0之后的版本支持jit+oat的方式编译，支持app配置baseline-profile的方式设置热点代码。</p>
<p>1.最初安装应用时不进行任何 AOT 编译。应用前几次运行时，系统会对其进行解译，并对经常执行的方法进行 JIT 编译。</p>
<p>2.当设备闲置和充电时，编译守护程序会运行，以便根据在应用前几次运行期间生成的配置文件对常用代码进行 AOT 编译。</p>
<p>3.下一次重新启动应用时将会使用配置文件引导型代码，并避免在运行时对已经过编译的方法进行 JIT 编译。在应用后续运行期间经过 JIT 编译的方法将会添加到配置文件中，然后编译守护程序将会对这些方法进行 AOT 编译。</p>

      
    </div>

    
    
    
      <footer class="post-footer">
        <div class="post-eof"></div>
      </footer>
  </article>
  
  
  

      
  
  
  <article itemscope itemtype="http://schema.org/Article" class="post-block" lang="zh-CN">
    <link itemprop="mainEntityOfPage" href="http://github.com/2023/12/12/%E7%B3%BB%E7%BB%9F%E7%BA%A7%E6%95%85%E9%9A%9C%E6%B3%A8%E5%85%A5%E5%B7%A5%E5%85%B7%E8%B0%83%E7%A0%94/">

    <span hidden itemprop="author" itemscope itemtype="http://schema.org/Person">
      <meta itemprop="image" content="/images/avatar.gif">
      <meta itemprop="name" content="dz">
      <meta itemprop="description" content="">
    </span>

    <span hidden itemprop="publisher" itemscope itemtype="http://schema.org/Organization">
      <meta itemprop="name" content="blog of dz">
    </span>
      <header class="post-header">
        <h2 class="post-title" itemprop="name headline">
          
            <a href="/2023/12/12/%E7%B3%BB%E7%BB%9F%E7%BA%A7%E6%95%85%E9%9A%9C%E6%B3%A8%E5%85%A5%E5%B7%A5%E5%85%B7%E8%B0%83%E7%A0%94/" class="post-title-link" itemprop="url">系统级故障注入工具调研</a>
        </h2>

        <div class="post-meta">
            <span class="post-meta-item">
              <span class="post-meta-item-icon">
                <i class="far fa-calendar"></i>
              </span>
              <span class="post-meta-item-text">发表于</span>

              <time title="创建时间：2023-12-12 16:29:45" itemprop="dateCreated datePublished" datetime="2023-12-12T16:29:45+08:00">2023-12-12</time>
            </span>
              <span class="post-meta-item">
                <span class="post-meta-item-icon">
                  <i class="far fa-calendar-check"></i>
                </span>
                <span class="post-meta-item-text">更新于</span>
                <time title="修改时间：2023-12-18 17:41:17" itemprop="dateModified" datetime="2023-12-18T17:41:17+08:00">2023-12-18</time>
              </span>

          

        </div>
      </header>

    
    
    
    <div class="post-body" itemprop="articleBody">

      
          <h1 id="前言"><a href="#前言" class="headerlink" title="前言"></a>前言</h1><p>为了实现系统可靠性的分析研究，首要解决问题是实现系统的故障注入和性能监测，其中最先需要解决的是工具的调研和使用<br>下列几种linux中常用的系统性能分析工具：</p>
<h2 id="systemtap"><a href="#systemtap" class="headerlink" title="systemtap"></a>systemtap</h2><p>systemtap是利用Kprobe提供的API来实现动态地监控和跟踪运行中的linux内核的工具，经未严谨调研，所需的内核版本要求包括：</p>
<p>基本功能支持:<br>    2.6.9+ - 基本的 Systemtap 工作需要<br>用户空间探针支持(uprobes):<br>    2.6.38+ - 用户函数的跟踪需要该版本以上<br>64位用户空间支持:<br>    2.6.25+ - 支持对应用程序堆栈的64位解析<br>函数跟踪支持(tracepoints):<br>    2.6.32+ - 跟踪内核函数的入口和出口<br>内核函数图支持:<br>    3.x - 提供内核函数调用关系图分析<br>优化的内存访问速度:<br>    4.1+ - 通过直接读写内存提升速度<br>eBPF框架集成:<br>    4.1+ - 可将eBPF程序用于自定义分析</p>
<p>loongnix系统20.5和loongnix-server8.4内核版本均为4.19,高于所需内核版本要求。</p>
<p>systemtap安装需要所需版本的内核信息包，尚未来得及调研，后续会更新<br>    kernel-debuginfo<br>    kernel-debuginfo-common<br>    kernel-devel</p>
<p>systemtap官网：<a target="_blank" rel="noopener" href="https://sourceware.org/systemtap/index.html">https://sourceware.org/systemtap/index.html</a></p>
<h2 id="ebpf"><a href="#ebpf" class="headerlink" title="ebpf"></a>ebpf</h2><p>最近几年在linux系统和性能分析领域较为活跃的主流工具是eBPF(extended Berkeley Packet Filter)。<br>ebpf是一个安全的内核虚拟机，可以用于自定义Tracing和性能分析的内核函数，提供了在特定时间点改变内核或用户空间状态的能力。同上，经不严谨调研：<br>最低基础运行版本:3.18<br>    3.18版本内核引入了对eBPF的基本支持<br>用户空间探针(uprobes): 4.1+<br>    uprobes需要4.1以上内核版本<br>BTF(BPF Type Format):5.1+<br>    BTF用于内核编写和分析的类型元数据,需要5.1以上<br>CO-RE(BPF Ring Buffer): 4.12+<br>    响应式输出缓存环需要4.12以上版本<br>内核函数回调(kprobes): 4.20+<br>    4.20引入bpf_get_stackid等功能以解决lockdep问题<br>内核增强函数(kfunc): 5.6+<br>    kfunc允许无锁定内核函数的bpf程序,需要5.6以上<br>BPF锁定: 4.20+<br>    bpf spin_lock&#x2F;unlock 需要4.20以后版本</p>
<p>某些核心功能内核版本要求高于4.19,实际上由于ebpf技术演进较快，新功能基本都需要新内核的支持，建议采用5.11以上的内核版本。初步判定不适合课题使用，先调研于此。<br>附ebpf官网链接：<a target="_blank" rel="noopener" href="https://ebpf.io/zh-cn/">https://ebpf.io/zh-cn/</a></p>
<p>更：所以 ebpf 实际上是类 Unix 系统上数据链路层的一种原始接口，他可以提供原始链路层包的收发和过滤。</p>
<p>再说简单一点，他就是一个带有过滤功能的数据包收发接口，当然也是可以 dump 数据的。</p>
<p>另外，ebpf 只能读取系统调用的参数和返回值，而不能修改任何寄存器（用户态或者内核态），因此它本身并不具有拦截功能。这一限制实际是其内部 verifier.c 模块的一个部分，真正的目的是为了保证内核本身的运行安全。因此在编写 BPF C 程序时，要非常小心的处理指针操作，避免一切的未定义行为（第5课的实验中会强调）；如果出现了未被 verifier.c 检测出的异常行为，也会在执行时被其他模块中断<br>故：可能不适合作为本次故障注入工具</p>

      
    </div>

    
    
    
      <footer class="post-footer">
        <div class="post-eof"></div>
      </footer>
  </article>
  
  
  

      
  
  
  <article itemscope itemtype="http://schema.org/Article" class="post-block" lang="zh-CN">
    <link itemprop="mainEntityOfPage" href="http://github.com/2023/12/03/%E4%BD%BF%E7%94%A8clonezilla%E8%BF%9B%E8%A1%8Cubuntu%E8%BF%81%E7%A7%BB/">

    <span hidden itemprop="author" itemscope itemtype="http://schema.org/Person">
      <meta itemprop="image" content="/images/avatar.gif">
      <meta itemprop="name" content="dz">
      <meta itemprop="description" content="">
    </span>

    <span hidden itemprop="publisher" itemscope itemtype="http://schema.org/Organization">
      <meta itemprop="name" content="blog of dz">
    </span>
      <header class="post-header">
        <h2 class="post-title" itemprop="name headline">
          
            <a href="/2023/12/03/%E4%BD%BF%E7%94%A8clonezilla%E8%BF%9B%E8%A1%8Cubuntu%E8%BF%81%E7%A7%BB/" class="post-title-link" itemprop="url">使用clonezilla进行ubuntu迁移</a>
        </h2>

        <div class="post-meta">
            <span class="post-meta-item">
              <span class="post-meta-item-icon">
                <i class="far fa-calendar"></i>
              </span>
              <span class="post-meta-item-text">发表于</span>
              

              <time title="创建时间：2023-12-03 08:59:31 / 修改时间：09:36:46" itemprop="dateCreated datePublished" datetime="2023-12-03T08:59:31+08:00">2023-12-03</time>
            </span>

          

        </div>
      </header>

    
    
    
    <div class="post-body" itemprop="articleBody">

      
          <p><a target="_blank" rel="noopener" href="https://zhuanlan.zhihu.com/p/354584111">参考文章地址</a></p>
<h2 id="1。起因"><a href="#1。起因" class="headerlink" title="1。起因"></a>1。起因</h2><p>由于之前的ubuntu系统装在128G的老固态硬盘上，逐渐空间不够，故萌生更换硬盘的念头，又原谅我比较懒，源系统中设置了很多个性化设置，所以十分不愿重装系统，经多方搜寻，发现clonezilla十分好用，故记录并附上资源</p>
<h2 id="2-步骤"><a href="#2-步骤" class="headerlink" title="2.步骤"></a>2.步骤</h2><p>具体分为两步，使用clonezilla从资源盘对源系统进行封装，再将封装的镜像文件恢复到目标盘。</p>
<p>需要的条件：<br>U盘一个（用于烧录clonezilla软件）</p>
<p>源系统盘和目标盘</p>
<p>ext4存储区域一块（这里说明一下，可以使用U盘，也可以划分磁盘的一块区域，但是文件格式必须为ext4，用来暂时存储封装的系统，本人因为电脑上还有一块专门存数据的机械硬盘，故划分100G。windows下可以使用diskgenius划分，可直接转换成ext4格式，直接用windows自带的磁盘管理器则不能）</p>
<h3 id="2-0安装clonezilla"><a href="#2-0安装clonezilla" class="headerlink" title="2.0安装clonezilla"></a>2.0安装clonezilla</h3><p>官方提供两种下载方式，一种是iso，另一种是zip，推荐使用iso用ultraiso进行烧录，zip需要下载安装tuxboot，还需要安装一些依赖包，懒得搞了，没有ultraiso省心</p>
<p><a target="_blank" rel="noopener" href="https://clonezilla.org/downloads.php">clonezilla下载地址</a></p>
<p>烧录没什么好说的，按照教程直接点点点，便捷启动选择写入新的驱动器引导扇区，选择Syslinux</p>
<h3 id="2-1从U盘启动clonezilla"><a href="#2-1从U盘启动clonezilla" class="headerlink" title="2.1从U盘启动clonezilla"></a>2.1从U盘启动clonezilla</h3><p>按照教程直接选择默认即可，封装后的系统会存储在上文提到的ext4存储区域</p>
<h3 id="2-2从封装文件恢复系统到目标盘"><a href="#2-2从封装文件恢复系统到目标盘" class="headerlink" title="2.2从封装文件恢复系统到目标盘"></a>2.2从封装文件恢复系统到目标盘</h3><p>可按照教程一步一步来，但是在选择目的硬盘后，可以选择是否按照原系统分区还是按比例扩展分区，这个按比例扩展分区是扩展几个系统分区，交换分区swap和引导分区boot并不包含在内，由于我的目标盘较大，直接选择按比例扩展即可，不然ubuntu系统分区由于是连续的，部分分区无法扩展</p>

      
    </div>

    
    
    
      <footer class="post-footer">
        <div class="post-eof"></div>
      </footer>
  </article>
  
  
  

      
  
  
  <article itemscope itemtype="http://schema.org/Article" class="post-block" lang="zh-CN">
    <link itemprop="mainEntityOfPage" href="http://github.com/2023/11/28/git%E4%BD%BF%E7%94%A8%E5%87%A0%E5%88%99/">

    <span hidden itemprop="author" itemscope itemtype="http://schema.org/Person">
      <meta itemprop="image" content="/images/avatar.gif">
      <meta itemprop="name" content="dz">
      <meta itemprop="description" content="">
    </span>

    <span hidden itemprop="publisher" itemscope itemtype="http://schema.org/Organization">
      <meta itemprop="name" content="blog of dz">
    </span>
      <header class="post-header">
        <h2 class="post-title" itemprop="name headline">
          
            <a href="/2023/11/28/git%E4%BD%BF%E7%94%A8%E5%87%A0%E5%88%99/" class="post-title-link" itemprop="url">git使用几则</a>
        </h2>

        <div class="post-meta">
            <span class="post-meta-item">
              <span class="post-meta-item-icon">
                <i class="far fa-calendar"></i>
              </span>
              <span class="post-meta-item-text">发表于</span>

              <time title="创建时间：2023-11-28 20:40:25" itemprop="dateCreated datePublished" datetime="2023-11-28T20:40:25+08:00">2023-11-28</time>
            </span>
              <span class="post-meta-item">
                <span class="post-meta-item-icon">
                  <i class="far fa-calendar-check"></i>
                </span>
                <span class="post-meta-item-text">更新于</span>
                <time title="修改时间：2024-03-04 14:22:07" itemprop="dateModified" datetime="2024-03-04T14:22:07+08:00">2024-03-04</time>
              </span>

          

        </div>
      </header>

    
    
    
    <div class="post-body" itemprop="articleBody">

      
          <h2 id="1-直接使用git-clone下载子模块项目"><a href="#1-直接使用git-clone下载子模块项目" class="headerlink" title="1.直接使用git clone下载子模块项目"></a>1.直接使用git clone下载子模块项目</h2><p>git clone –recursive [url]</p>
<h2 id="2-先下载部分内容，再对子模块进行初始化"><a href="#2-先下载部分内容，再对子模块进行初始化" class="headerlink" title="2.先下载部分内容，再对子模块进行初始化"></a>2.先下载部分内容，再对子模块进行初始化</h2><p>初始化本地子模块配置文件<br>git submodule init</p>
<p>更新项目，抓取子模块内容<br>git submodule update</p>

      
    </div>

    
    
    
      <footer class="post-footer">
        <div class="post-eof"></div>
      </footer>
  </article>
  
  
  

      
  
  
  <article itemscope itemtype="http://schema.org/Article" class="post-block" lang="zh-CN">
    <link itemprop="mainEntityOfPage" href="http://github.com/2023/11/10/%E4%BA%91%E8%AE%A1%E7%AE%97%E6%A8%A1%E6%8B%9F%E5%B7%A5%E5%85%B7/">

    <span hidden itemprop="author" itemscope itemtype="http://schema.org/Person">
      <meta itemprop="image" content="/images/avatar.gif">
      <meta itemprop="name" content="dz">
      <meta itemprop="description" content="">
    </span>

    <span hidden itemprop="publisher" itemscope itemtype="http://schema.org/Organization">
      <meta itemprop="name" content="blog of dz">
    </span>
      <header class="post-header">
        <h2 class="post-title" itemprop="name headline">
          
            <a href="/2023/11/10/%E4%BA%91%E8%AE%A1%E7%AE%97%E6%A8%A1%E6%8B%9F%E5%B7%A5%E5%85%B7/" class="post-title-link" itemprop="url">未命名</a>
        </h2>

        <div class="post-meta">
            <span class="post-meta-item">
              <span class="post-meta-item-icon">
                <i class="far fa-calendar"></i>
              </span>
              <span class="post-meta-item-text">发表于</span>
              

              <time title="创建时间：2023-11-10 02:47:59 / 修改时间：02:49:19" itemprop="dateCreated datePublished" datetime="2023-11-10T02:47:59+08:00">2023-11-10</time>
            </span>

          

        </div>
      </header>

    
    
    
    <div class="post-body" itemprop="articleBody">

      
          <h1 id="云计算模拟工具收集"><a href="#云计算模拟工具收集" class="headerlink" title="云计算模拟工具收集"></a>云计算模拟工具收集</h1><p>cloudsim<br>介绍网址：<a target="_blank" rel="noopener" href="http://cloudbus.org/cloudsim/">http://cloudbus.org/cloudsim/</a><br>github网址：<a href="https://github.com/Cloudslab/cloudsim">https://github.com/Cloudslab/cloudsim</a></p>

      
    </div>

    
    
    
      <footer class="post-footer">
        <div class="post-eof"></div>
      </footer>
  </article>
  
  
  

      
  
  
  <article itemscope itemtype="http://schema.org/Article" class="post-block" lang="zh-CN">
    <link itemprop="mainEntityOfPage" href="http://github.com/2023/11/02/live-migration/">

    <span hidden itemprop="author" itemscope itemtype="http://schema.org/Person">
      <meta itemprop="image" content="/images/avatar.gif">
      <meta itemprop="name" content="dz">
      <meta itemprop="description" content="">
    </span>

    <span hidden itemprop="publisher" itemscope itemtype="http://schema.org/Organization">
      <meta itemprop="name" content="blog of dz">
    </span>
      <header class="post-header">
        <h2 class="post-title" itemprop="name headline">
          
            <a href="/2023/11/02/live-migration/" class="post-title-link" itemprop="url">survey of live-migration 1</a>
        </h2>

        <div class="post-meta">
            <span class="post-meta-item">
              <span class="post-meta-item-icon">
                <i class="far fa-calendar"></i>
              </span>
              <span class="post-meta-item-text">发表于</span>

              <time title="创建时间：2023-11-02 01:24:48" itemprop="dateCreated datePublished" datetime="2023-11-02T01:24:48+08:00">2023-11-02</time>
            </span>
              <span class="post-meta-item">
                <span class="post-meta-item-icon">
                  <i class="far fa-calendar-check"></i>
                </span>
                <span class="post-meta-item-text">更新于</span>
                <time title="修改时间：2023-11-03 18:54:26" itemprop="dateModified" datetime="2023-11-03T18:54:26+08:00">2023-11-03</time>
              </span>

          

        </div>
      </header>

    
    
    
    <div class="post-body" itemprop="articleBody">

      
          <h1 id="A-Survey-on-Mobility-Induced-Service-Migration-in-the-Fog-Edge-and-Related-Computing-Paradigms阅读总结"><a href="#A-Survey-on-Mobility-Induced-Service-Migration-in-the-Fog-Edge-and-Related-Computing-Paradigms阅读总结" class="headerlink" title="A Survey on Mobility-Induced Service Migration in the Fog,Edge, and Related Computing Paradigms阅读总结"></a>A Survey on Mobility-Induced Service Migration in the Fog,Edge, and Related Computing Paradigms阅读总结</h1><h2 id="迁移方式"><a href="#迁移方式" class="headerlink" title="迁移方式"></a>迁移方式</h2><p><img src="/images/live-migration-1.png" alt="图1" title="图1"></p>
<h3 id="stateless-无状态"><a href="#stateless-无状态" class="headerlink" title="stateless 无状态"></a>stateless 无状态</h3><p>无状态迁移与没有运行状态的无状态服务相关联，因此，迁移过程仅包括在目标节点重新部署服务</p>
<h3 id="stateful-有状态"><a href="#stateful-有状态" class="headerlink" title="stateful 有状态"></a>stateful 有状态</h3><p>有状态迁移分为冷迁移和热迁移<br>冷迁移时，虚拟机会被暂停，然后转移到目的地，并在目的地恢复。在此期间，当前主机上的服务不可用。服务不可用的这段时期称为停机时间。<br>热迁移又分为预复制（pre-copy）、后复制(post-copy)和混合迁移(hybrid)</p>
<p>1、推送阶段，在此期间内存页面被迭代推送到目标，同时虚拟机仍在源上运行。 “脏”页面，即自上次迭代以来修改过的页面，将在后续迭代中再次发送。<br>2、停止和复制阶段：源上的VM 停止。然后，剩余页面将复制到目标，虚拟机将在该目标重新启动。<br>3、拉取阶段：当虚拟机在目的地恢复执行时，访问尚未复制的页面时可能会出现页面错误。然后，在此阶段将从源节点拉出这些页面。</p>
<p>pre-copy<br>在预复制阶段，Hypervisor 将所有内存页面从源复制到目标，同时 VM 仍在源上运行。如果某些内存页在预复制阶段发生变化（变得“脏”），它们将在几个“预复制轮次”中被一次又一次地复制(迭代拷贝)。通常，当剩余的脏页数量变得足够少以产生短暂的停止和复制阶段时，预复制阶段结束。（收敛速度）但是，如果虚拟机弄脏内存的速度快于重新复制到目标的速度，则预复制阶段将在设定的时间限制或最大预复制轮数后结束，直接开始下一个停止和复制阶段。<br><img src="/images/live-migration-10.png" alt="pre-copy"></p>
<p>post-copy<br>复制后 VM 迁移是通过在源处挂起 VM 来启动的。当 VM 挂起时，VM 执行状态的最小子集（CPU 状态、寄存器以及可选的不可分页内存）将传输到目标。然后 VM 将在目标处恢复。同时，源主动将 VM 的剩余内存页面推送到目标 - 这种活动称为预分页(pre-paging)。在目标上，如果虚拟机尝试访问尚未传输的页面，则会生成页面错误。这些故障（称为网络故障）被捕获在目标处并重定向到源，源以故障页面进行响应。太多的网络故障会降低虚拟机内运行的应用程序的性能。因此，预分页可以通过主动推送最后一个故障附近的页面来动态调整页面传输顺序以适应网络故障。理想的预分页方案将掩盖大部分网络故障，尽管其性能取决于虚拟机工作负载的内存访问模式。<br>后复制通过网络将每个页面只发送一次，而如果页面在迁移过程中在源处反复变脏，则预复制可以多次传输同一页面。另一方面，预复制会在迁移期间保留源处 VM 的最新状态，而在后复制期间，VM 的状态会分布在源和目标之间。如果实时迁移过程中目标发生故障，预复制可以恢复虚拟机，而后复制则不能。<br><img src="/images/live-migration-11.png" alt="post-copy"></p>
<p>预复制迁移执行推送阶段，然后执行停止和复制阶段，而后复制迁移则执行停止和复制阶段，然后执行拉取阶段</p>
<h2 id="迁移优化方向"><a href="#迁移优化方向" class="headerlink" title="迁移优化方向"></a>迁移优化方向</h2><p><img src="/images/live-migration-2.png" alt="图2" title="图2"><br>主要分为三个方向，降低性能消耗，降低时间消耗，提高迁移成功率</p>
<p>性能消耗（服务规模、服务启动&#x2F;发布成本以及迁移服务所消耗的带宽）：<br>1、成本权衡：当必须做出迁移决定时，都必须在迁移服务带来的潜在收益（例如，QoS 改进,quality of service）和迁移可能产生的成本之间进行权衡。或者，权衡可以涉及评估不同类型的成本对性能的影响。<br>对问题进行建模，使用不同的方法，如：马尔科夫链，混合整数线性规划等<br><img src="/images/live-migration-3.png" alt="图3" title="图3"><br><img src="/images/live-migration-4.png" alt="图4" title="图4"><br>2、基于移动模式的迁移避免：根据用户的移动模式预测未来的迁移目标<br><img src="/images/live-migration-5.png" alt="图5" title="图5"></p>
<p>时间消耗：<br>1、虚拟化技术相关<br>虚拟机相关的优化<br>eg：[21]一种预复制算法，其中“冷”页面（即写入概率较低的内存页面）被发送到目的地，而“热”页面被跳过，因此建议将其命名为“热跳过”，效果是减少迭代长度并缩短迁移时间<br>容器相关的优化<br>eg:[38]”冗余迁移”,以避免stop and copy阶段。DS使用SS创立的“检查点”恢复容器运行，并在源与目标主机之间设立一个缓冲区用于传输数据，目标主机利用传输的数据进行重演，当缓冲区为空时说明目标主机可以接管源主机。<br>线程相关优化<br>eg:[45] [19]仅传输包含应用程序状态的有状态进程,操作系统和无状态进程不需要迁移。为了实现进程间通信的连续性，作者引入了一种正确转换进程间通信通道的方法<br><img src="/images/live-migration-6.png" alt="图6" title="图6"><br>2、基于TCP的多路径优化<br>MPTCP 依赖于多个接口的同时使用，从而允许跨不同的子流发送数据。这对于提高以边缘为中心的环境中迁移的弹性特别有利，因为迁移是通过可能遭受拥塞或故障问题的 WAN 链路执行的。<br>3、主动行动<br>主动采取行动准备迁移环境或规划迁移执行来解决减少迁移延迟。(多数需要节点的位置等信息)<br>eg:[13]在此实现中，使用回归模型来预测用户的移动。然后，当预测用户将改变其服务MEC时，请求目标MEC发起迁移过程<br><img src="/images/live-migration-7.png" alt="图7" title="图7"><br>4、时间相关的最佳服务重新放置<br>寻找服务迁移的最佳节点（从更高的层次去优化，如集群等，主要是减少传输时延）<br><img src="/images/live-migration-8.png" alt="图8" title="图8"></p>
<p>提高迁移成功率<br>（属于此类别的贡献完全来自车辆云研究领域。这主要是由于这种场景的动态性，因此可能会对迁移成功率产生负面影响。）<br>与卫星的动态性类似<br>eg:[104]中的作者解决了当目标云由于负载过多而无法容纳虚拟机时可能出现的迁移不成功的问题<br><img src="/images/live-migration-9.png" alt="图9" title="图9"></p>

      
    </div>

    
    
    
      <footer class="post-footer">
        <div class="post-eof"></div>
      </footer>
  </article>
  
  
  

      
  
  
  <article itemscope itemtype="http://schema.org/Article" class="post-block" lang="zh-CN">
    <link itemprop="mainEntityOfPage" href="http://github.com/2023/10/23/openstack%E5%86%B7%E8%BF%81%E7%A7%BB/">

    <span hidden itemprop="author" itemscope itemtype="http://schema.org/Person">
      <meta itemprop="image" content="/images/avatar.gif">
      <meta itemprop="name" content="dz">
      <meta itemprop="description" content="">
    </span>

    <span hidden itemprop="publisher" itemscope itemtype="http://schema.org/Organization">
      <meta itemprop="name" content="blog of dz">
    </span>
      <header class="post-header">
        <h2 class="post-title" itemprop="name headline">
          
            <a href="/2023/10/23/openstack%E5%86%B7%E8%BF%81%E7%A7%BB/" class="post-title-link" itemprop="url">未命名</a>
        </h2>

        <div class="post-meta">
            <span class="post-meta-item">
              <span class="post-meta-item-icon">
                <i class="far fa-calendar"></i>
              </span>
              <span class="post-meta-item-text">发表于</span>

              <time title="创建时间：2023-10-23 19:26:57" itemprop="dateCreated datePublished" datetime="2023-10-23T19:26:57+08:00">2023-10-23</time>
            </span>
              <span class="post-meta-item">
                <span class="post-meta-item-icon">
                  <i class="far fa-calendar-check"></i>
                </span>
                <span class="post-meta-item-text">更新于</span>
                <time title="修改时间：2023-10-26 19:24:55" itemprop="dateModified" datetime="2023-10-26T19:24:55+08:00">2023-10-26</time>
              </span>

          

        </div>
      </header>

    
    
    
    <div class="post-body" itemprop="articleBody">

      
          <p>from openstack import connection<br>conn &#x3D; connection.Connection(<br>    auth_url&#x3D;’<a target="_blank" rel="noopener" href="http://controller:5000/v3">http://controller:5000/v3</a>‘,<br>    project_name&#x3D;’admin’,<br>    username&#x3D;’admin’,<br>    password&#x3D;’loongson’,<br>    user_domain_name&#x3D;’Default’,<br>    project_domain_name&#x3D;’Default’<br>)<br>servers &#x3D; conn.compute.servers()<br>for server in servers:<br>    print(server.name)</p>
<h1 id="获取计算节点列表"><a href="#获取计算节点列表" class="headerlink" title="获取计算节点列表"></a>获取计算节点列表</h1><p>hypervisors &#x3D; conn.compute.hypervisors()<br>for hs in hypervisors:<br>    print(hs .hypervisor_hostname)</p>
<p>hosts &#x3D; conn.compute.hosts()<br>for host in hosts:<br>    print(host.host_name)</p>
<p>nova live-migration  [实例id]  [计算节点] </p>

      
    </div>

    
    
    
      <footer class="post-footer">
        <div class="post-eof"></div>
      </footer>
  </article>
  
  
  

      
  
  
  <article itemscope itemtype="http://schema.org/Article" class="post-block" lang="zh-CN">
    <link itemprop="mainEntityOfPage" href="http://github.com/2023/10/10/%E9%BE%99%E8%8A%AFopenstack%E5%8D%95%E8%8A%82%E7%82%B9%E9%83%A8%E7%BD%B2/">

    <span hidden itemprop="author" itemscope itemtype="http://schema.org/Person">
      <meta itemprop="image" content="/images/avatar.gif">
      <meta itemprop="name" content="dz">
      <meta itemprop="description" content="">
    </span>

    <span hidden itemprop="publisher" itemscope itemtype="http://schema.org/Organization">
      <meta itemprop="name" content="blog of dz">
    </span>
      <header class="post-header">
        <h2 class="post-title" itemprop="name headline">
          
            <a href="/2023/10/10/%E9%BE%99%E8%8A%AFopenstack%E5%8D%95%E8%8A%82%E7%82%B9%E9%83%A8%E7%BD%B2/" class="post-title-link" itemprop="url">龙芯openstack单节点部署</a>
        </h2>

        <div class="post-meta">
            <span class="post-meta-item">
              <span class="post-meta-item-icon">
                <i class="far fa-calendar"></i>
              </span>
              <span class="post-meta-item-text">发表于</span>

              <time title="创建时间：2023-10-10 03:32:55" itemprop="dateCreated datePublished" datetime="2023-10-10T03:32:55+08:00">2023-10-10</time>
            </span>
              <span class="post-meta-item">
                <span class="post-meta-item-icon">
                  <i class="far fa-calendar-check"></i>
                </span>
                <span class="post-meta-item-text">更新于</span>
                <time title="修改时间：2023-12-03 09:41:35" itemprop="dateModified" datetime="2023-12-03T09:41:35+08:00">2023-12-03</time>
              </span>

          

        </div>
      </header>

    
    
    
    <div class="post-body" itemprop="articleBody">

      
          <h1 id="openstack单节点部署"><a href="#openstack单节点部署" class="headerlink" title="openstack单节点部署"></a>openstack单节点部署</h1><h2 id="1-所有服务器部署系统8-4"><a href="#1-所有服务器部署系统8-4" class="headerlink" title="1.所有服务器部署系统8.4"></a>1.所有服务器部署系统8.4</h2><p>docker创建镜像<br><code>docker run -d -it -v /host_dic:/guest_dic -v /sys/fs/cgroup:/sys/fs/cgroup:ro --cap-add SYS_ADMIN --net host --name docker_name docker_id /sbin/init</code><br>根据实际修改为<br><code>sudo docker run -d -it -v /host_dic:/guest_dic -v /sys/fs/cgroup:/sys/fs/cgroup:ro -v /lib/modules:/lib/modules --cap-add SYS_ADMIN --net host --hostname controller --name dz-openstack-controller cr.loongnix.cn/loongson/loongnix-server:8.4.0 /sbin/init</code><br>-v &#x2F;lib&#x2F;modules:&#x2F;lib&#x2F;modules挂载宿主机模块（一些服务需要用到bridge,br_netfilter），–privileged 添加特权不然一些只读文件无法读写（比如neutron-linux-agent服务需要对net.bridge.bridge-nf-call-iptables文件进行读写，该文件是宿主机的只读文件权限不够），–hostname controller提前设置好主机名，更改主机名需要重启容器<br><code>sudo docker run -d -it -v /host_dic:/guest_dic -v /sys/fs/cgroup:/sys/fs/cgroup:ro -v /lib/modules:/lib/modules --privileged --cap-add ALL --net host --hostname controller --name dz-openstack-controller2 cr.loongnix.cn/loongson/loongnix-server:8.4.0 /sbin/init</code><br>用的服务器镜像为<br>cr.loongnix.cn&#x2F;loongson&#x2F;loongnix-server:8.4.0<br>openstack loongarch版源<br>[<a target="_blank" rel="noopener" href="https://pkg.loongnix.cn/loongnix-server/8.4/cloud/loongarch64/release/openstack-ussuri/]">https://pkg.loongnix.cn/loongnix-server/8.4/cloud/loongarch64/release/openstack-ussuri/]</a><br>由于自带yum镜像路径有问题,前往&#x2F;etc&#x2F;yum.repos.d&#x2F;路径下修改<br>（8.3用的路径是<a target="_blank" rel="noopener" href="http://pkg.loongnix.cn/loongnix-server/$releasever/loongnixplus/$basearch/release/">http://pkg.loongnix.cn/loongnix-server/$releasever/loongnixplus/$basearch/release/</a><br>8.4用的路径是<a target="_blank" rel="noopener" href="http://pkg.loongnix.cn/loongnix-server/$releasever/Loongnixplus/$basearch/release/%EF%BC%89">http://pkg.loongnix.cn/loongnix-server/$releasever/Loongnixplus/$basearch/release/）</a><br>[plus]<br>name&#x3D;Loongnix server $releasever - Plus<br>baseurl&#x3D;<a target="_blank" rel="noopener" href="http://pkg.loongnix.cn/loongnix-server/$releasever/Loongnixplus/$basearch/release/">http://pkg.loongnix.cn/loongnix-server/$releasever/Loongnixplus/$basearch/release/</a><br>gpgcheck&#x3D;0<br>enabled&#x3D;1<br>gpgkey&#x3D;file:&#x2F;&#x2F;&#x2F;etc&#x2F;pki&#x2F;rpm-gpg&#x2F;RPM-GPG-KEY-LOONGNIX</p>
<p>创建好docker容器后，首先保证ssh通畅，docker容器内需要修改&#x2F;etc&#x2F;ssh&#x2F;sshd_config文件，做端口穿透（防止与宿主机ssh端口冲突），增加port 222<br>新安装的系统需要做如下设置<br><code>yum install -y vim openssh-server git rsync net-tools passwd &amp; systemctl start sshd </code><br>passwd设置root密码，以实现ssh远程认证（自己设置的是123！）</p>
<h2 id="2-配置网卡"><a href="#2-配置网卡" class="headerlink" title="2.配置网卡"></a>2.配置网卡</h2><p>所有服务器2块网卡, 配置第二块网卡 enp0s3f1作为provider 接口, 不配置ip, 同时需要修改&#x2F;etc&#x2F;sysconfig&#x2F;network-scripts&#x2F;enp0s3f1 下列选项</p>
<figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br></pre></td><td class="code"><pre><span class="line">BOOTPROTO=none</span><br><span class="line">ONBOOT=yes</span><br></pre></td></tr></table></figure>
<p>然后重启系统</p>
<h2 id="3-下载部署脚本"><a href="#3-下载部署脚本" class="headerlink" title="3.下载部署脚本"></a>3.下载部署脚本</h2><p>选择一个节点作为控制节点controller, 在controller节点执行<br><code>yum install -y git</code><br><code>git clone https://gitee.com/leowuqiong/openstack-install.git</code><br>或者<br><code>git clone git@github.com:myLFD/openstack-install.git</code><br>(脚本后续尚待完善)</p>
<h2 id="4-配置服务器信息"><a href="#4-配置服务器信息" class="headerlink" title="4.配置服务器信息"></a>4.配置服务器信息</h2><p>进入&#x2F;root&#x2F;openstack-install目录,按照实际情况编辑config-host脚本相关信息<br>#要设置的hostname, ip, root用户密码, provider网卡接口名称(不配ip那块网卡)<br>node&#x3D;(<br>“controller,192.168.200.118,loongson123!@#,enp0s3f1”<br>“compute1,192.168.200.19,loongson123!@#,enp0s3f1”<br>“compute2,192.168.200.50,loongson123!@#,enp0s3f1”<br>……<br>)</p>
<p>执行config-host脚本, 会自动将所有服务器的hostname, 免密, &#x2F;etc&#x2F;hosts配置完成.<br>.&#x2F;config-host.sh</p>
<h2 id="5-安装控制节点"><a href="#5-安装控制节点" class="headerlink" title="5.安装控制节点"></a>5.安装控制节点</h2><p>进入&#x2F;root&#x2F;openstack-install&#x2F;openstack目录, 按照实际情况修改variable.sh,然后执行安装脚本.&#x2F;controller-install.sh</p>
<p>httpd服务启动failed：<br>&#x2F;usr&#x2F;share&#x2F;openstack-dashboard&#x2F;openstack-dashboard&#x2F;settings.py里面更改LANGUAGE_CODE&#x3D;’zh-cn’即可重新启动，原因不明</p>
<h2 id="6-安装计算节点"><a href="#6-安装计算节点" class="headerlink" title="6.安装计算节点"></a>6.安装计算节点</h2><p>登录计算节点, 进入&#x2F;root&#x2F;openstack-instal&#x2F;openstack目录, 按照实际情况修改variable.sh,然后执行安装脚本.&#x2F;compute-install.sh</p>
<p>计算节点注意在&#x2F;etc&#x2F;hosts中添加一行，以添加控制节点映射[10.40.65.186 controller]</p>
<p>如果要启动动态迁移，运行&#x2F;tools&#x2F;live-migration.sh，配置versh免密码连接<br>可以使用<code>netstat -lnpt | grep libvirtd</code>检查libvirt是否监听16509端口，显示如下则正确<br>tcp        0      0 172.16.206.6:16509      0.0.0.0:*               LISTEN      9852&#x2F;libvirtd</p>
<figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br></pre></td><td class="code"><pre><span class="line">在compute1节点上：</span><br><span class="line"></span><br><span class="line">virsh -c qemu+tcp://compute2/system</span><br><span class="line"></span><br><span class="line">在compute2节点上</span><br><span class="line"></span><br><span class="line">virsh -c qemu+tcp://compute1/system</span><br><span class="line"></span><br><span class="line">如果能无密码连接上去，表示配置没问题</span><br></pre></td></tr></table></figure>

<h2 id="7-计算节点发现"><a href="#7-计算节点发现" class="headerlink" title="7.计算节点发现"></a>7.计算节点发现</h2><p>所有计算节点部署完成后,登陆controller<br><code> nova-manage cell_v2 discover_hosts --verbose</code></p>
<h2 id="8-安装卷服务CINDER（可选）"><a href="#8-安装卷服务CINDER（可选）" class="headerlink" title="8.安装卷服务CINDER（可选）"></a>8.安装卷服务CINDER（可选）</h2><p>在控制节点格式化一个lvm的盘sdb1, 如果不是sdb1, 需要修改&#x2F;root&#x2F;openstack-install&#x2F;openstack&#x2F;cinder.sh脚本对应内容<br>进入&#x2F;root&#x2F;openstack-instal&#x2F;openstack目录, 执行</p>
<figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br></pre></td><td class="code"><pre><span class="line">source variable.sh</span><br><span class="line">source openstack-rc</span><br><span class="line">./cinder.sh</span><br></pre></td></tr></table></figure>


<p>sudo apt-get install -y git-email<br>sudo apt-get install -y libaio-dev libbluetooth-dev libcapstone-dev libbrlapi-dev libbz2-dev<br>sudo apt-get install -y libcap-ng-dev libcurl4-gnutls-dev libgtk-3-dev<br>sudo apt-get install -y libibverbs-dev libjpeg8-dev libncurses5-dev libnuma-dev<br>sudo apt-get install -y librbd-dev librdmacm-dev<br>sudo apt-get install -y libsasl2-dev libsdl2-dev libseccomp-dev libsnappy-dev libssh-dev<br>sudo apt-get install -y libvde-dev libvdeplug-dev libvte-2.91-dev libxen-dev liblzo2-dev<br>sudo apt-get install -y valgrind xfslibs-dev </p>

      
    </div>

    
    
    
      <footer class="post-footer">
        <div class="post-eof"></div>
      </footer>
  </article>
  
  
  

      
  
  
  <article itemscope itemtype="http://schema.org/Article" class="post-block" lang="zh-CN">
    <link itemprop="mainEntityOfPage" href="http://github.com/2023/09/18/markdown/">

    <span hidden itemprop="author" itemscope itemtype="http://schema.org/Person">
      <meta itemprop="image" content="/images/avatar.gif">
      <meta itemprop="name" content="dz">
      <meta itemprop="description" content="">
    </span>

    <span hidden itemprop="publisher" itemscope itemtype="http://schema.org/Organization">
      <meta itemprop="name" content="blog of dz">
    </span>
      <header class="post-header">
        <h2 class="post-title" itemprop="name headline">
          
            <a href="/2023/09/18/markdown/" class="post-title-link" itemprop="url">MarkDown</a>
        </h2>

        <div class="post-meta">
            <span class="post-meta-item">
              <span class="post-meta-item-icon">
                <i class="far fa-calendar"></i>
              </span>
              <span class="post-meta-item-text">发表于</span>
              

              <time title="创建时间：2023-09-18 16:59:06 / 修改时间：19:58:40" itemprop="dateCreated datePublished" datetime="2023-09-18T16:59:06+08:00">2023-09-18</time>
            </span>

          

        </div>
      </header>

    
    
    
    <div class="post-body" itemprop="articleBody">

      
          <h1 id="MarkDown-学习记录"><a href="#MarkDown-学习记录" class="headerlink" title="MarkDown 学习记录"></a>MarkDown 学习记录</h1><h5 id="markdown官方教程链接"><a href="#markdown官方教程链接" class="headerlink" title="markdown官方教程链接"></a><a target="_blank" rel="noopener" href="https://markdown.com.cn/basic-syntax/">markdown官方教程链接</a></h5><h2 id="1-标题"><a href="#1-标题" class="headerlink" title="1.标题"></a>1.标题</h2><p>使用#表示标题，#的数量代表标题的级别  </p>
<figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br></pre></td><td class="code"><pre><span class="line"># 一级标题</span><br><span class="line">## 二级标题</span><br><span class="line">### 三级标题</span><br><span class="line">#### 四级标题</span><br><span class="line">##### 五级标题</span><br></pre></td></tr></table></figure>
<p>效果：</p>
<h1 id="一级标题"><a href="#一级标题" class="headerlink" title="一级标题"></a>一级标题</h1><h2 id="二级标题"><a href="#二级标题" class="headerlink" title="二级标题"></a>二级标题</h2><h3 id="三级标题"><a href="#三级标题" class="headerlink" title="三级标题"></a>三级标题</h3><h4 id="四级标题"><a href="#四级标题" class="headerlink" title="四级标题"></a>四级标题</h4><h5 id="五级标题"><a href="#五级标题" class="headerlink" title="五级标题"></a>五级标题</h5><h3 id="TIPS"><a href="#TIPS" class="headerlink" title="TIPS"></a>TIPS</h3><p>可在标题文本的下一行使用多个&#x3D;&#x3D;&#x3D;&#x3D;&#x3D;或者——-来分隔标题(不建议使用)<br>为了兼容不同MarkDown处理程序，#后需要加空格</p>
<h2 id="2-换行-段落"><a href="#2-换行-段落" class="headerlink" title="2.换行&amp;段落"></a>2.换行&amp;段落</h2><p>换行：两个或多个空格回车（教程所述），实测直接回车即可<br>段落：空白行分割</p>
<h2 id="3-加粗-斜体"><a href="#3-加粗-斜体" class="headerlink" title="3.加粗&amp;斜体"></a>3.加粗&amp;斜体</h2><p>使用两个星号<em>（建议）或者下划线_可以添加粗体，其中</em>可以对单词的一部分使用，注意不带空格</p>
<figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br></pre></td><td class="code"><pre><span class="line">**bold stick**</span><br><span class="line">bold __stick__</span><br><span class="line">bold s**t**ick</span><br></pre></td></tr></table></figure>
<p>效果如下：<br><strong>bold stick</strong><br>bold <strong>stick</strong><br>bold s<strong>t</strong>ick</p>
<p>使用一个星号*（建议）或者下划线_可以添加斜体，方案通上</p>
<figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br></pre></td><td class="code"><pre><span class="line">*bold stick*</span><br><span class="line">bold _stick_</span><br><span class="line">bold s*t*ick</span><br></pre></td></tr></table></figure>
<p>效果如下：<br><em>bold stick</em><br>bold <em>stick</em><br>bold s<em>t</em>ick</p>
<p>使用三个星星或下划线可以又粗又斜（狗头power）</p>
<figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br></pre></td><td class="code"><pre><span class="line">***bold stick***</span><br><span class="line">bold ___stick___</span><br><span class="line">bold s***t***ick</span><br></pre></td></tr></table></figure>
<p>效果如下：<br><em><strong>bold stick</strong></em><br>bold <em><strong>stick</strong></em><br>bold s<em><strong>t</strong></em>ick</p>
<h2 id="4-引用"><a href="#4-引用" class="headerlink" title="4.引用"></a>4.引用</h2><p>块引用：在段落前添加&gt;符号即可，多个段落间用&gt;作分割，嵌套&gt;&gt;，原理同#，下面偷懒使用官方例子</p>
<figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br></pre></td><td class="code"><pre><span class="line">&gt; Dorothy followed her through many of the beautiful rooms in her castle.</span><br><span class="line">&gt;</span><br><span class="line">&gt;&gt; The Witch bade her clean the pots and kettles and sweep the floor and keep the fire fed with wood.</span><br><span class="line">&gt; #### The quarterly results look great!</span><br><span class="line">&gt;</span><br><span class="line">&gt; - Revenue was off the chart.</span><br><span class="line">&gt; - Profits were higher than ever.</span><br><span class="line">&gt;</span><br><span class="line">&gt;  *Everything* is going according to **plan**.</span><br></pre></td></tr></table></figure>
<p>效果如下：</p>
<blockquote>
<p>Dorothy followed her through many of the beautiful rooms in her castle.</p>
<blockquote>
<p>The Witch bade her clean the pots and kettles and sweep the floor and keep the fire fed with wood.</p>
</blockquote>
<h4 id="The-quarterly-results-look-great"><a href="#The-quarterly-results-look-great" class="headerlink" title="The quarterly results look great!"></a>The quarterly results look great!</h4><ul>
<li>Revenue was off the chart.</li>
<li>Profits were higher than ever.</li>
</ul>
<p> <em>Everything</em> is going according to <strong>plan</strong>.</p>
</blockquote>
<h2 id="5-列表"><a href="#5-列表" class="headerlink" title="5.列表"></a>5.列表</h2><p>有序：列表项最前面添加数字+.<br>无序：列表项最前面添加破折号（-）、星号（*）、加号（+），尽量使用同一种符号</p>
<figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br></pre></td><td class="code"><pre><span class="line">- 第一行</span><br><span class="line">- 第二行</span><br><span class="line">- 第三行</span><br></pre></td></tr></table></figure>
<ul>
<li>第一行</li>
<li>第二行</li>
<li>第三行</li>
</ul>
<h2 id="6-代码"><a href="#6-代码" class="headerlink" title="6.代码"></a>6.代码</h2><p>单词短语使用&#96;或者&#96;&#96;，代码段需要缩进一个tab或者4个空格，或者可以围栏式代码块使用&#96;&#96;&#96;，创建不用缩进的代码块</p>
<figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br></pre></td><td class="code"><pre><span class="line">`beijing`</span><br><span class="line">``where is `beijing` ``</span><br><span class="line"></span><br></pre></td></tr></table></figure>
<p><code>beijing</code><br><code>where is `beijing` </code></p>
<h2 id="7-链接-网址-email-图片"><a href="#7-链接-网址-email-图片" class="headerlink" title="7.链接-网址&amp;email&amp;图片"></a>7.链接-网址&amp;email&amp;图片</h2><p>教程直接用：<code>[超链接显示名](超链接地址 &quot;超链接title&quot;)</code></p>
<figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">这是dz的博客 [blog of dz](https://mylfd.github.io &quot;最丢人的个人博客&quot;)。</span><br></pre></td></tr></table></figure>
<p>效果如下：<br>这是dz的博客 <a target="_blank" rel="noopener" href="https://mylfd.github.io/" title="最丢人的个人博客">blog of dz</a>。</p>
<p>尖括号可以把url和email变成链接</p>
<figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br></pre></td><td class="code"><pre><span class="line">&lt;https://mylfd.github.io&gt;</span><br><span class="line">&lt;fake@example.com&gt; </span><br></pre></td></tr></table></figure>
<p>效果如下：<br><a target="_blank" rel="noopener" href="https://mylfd.github.io/">https://mylfd.github.io</a><br><a href="mailto:&#102;&#x61;&#x6b;&#101;&#x40;&#101;&#120;&#97;&#109;&#x70;&#x6c;&#101;&#x2e;&#x63;&#x6f;&#x6d;">&#102;&#x61;&#x6b;&#101;&#x40;&#101;&#120;&#97;&#109;&#x70;&#x6c;&#101;&#x2e;&#x63;&#x6f;&#x6d;</a> </p>
<p>要添加图像，请使用感叹号 (!), 然后在方括号增加替代文本，图片链接放在圆括号里，括号里的链接后可以增加一个可选的图片标题文本<br>语法代码：<code>![图片alt](图片链接 &quot;图片title&quot;)</code></p>

      
    </div>

    
    
    
      <footer class="post-footer">
        <div class="post-eof"></div>
      </footer>
  </article>
  
  
  


  
  <nav class="pagination">
    <span class="page-number current">1</span><a class="page-number" href="/page/2/">2</a><a class="extend next" rel="next" href="/page/2/"><i class="fa fa-angle-right" aria-label="下一页"></i></a>
  </nav>



          </div>
          

<script>
  window.addEventListener('tabs:register', () => {
    let { activeClass } = CONFIG.comments;
    if (CONFIG.comments.storage) {
      activeClass = localStorage.getItem('comments_active') || activeClass;
    }
    if (activeClass) {
      let activeTab = document.querySelector(`a[href="#comment-${activeClass}"]`);
      if (activeTab) {
        activeTab.click();
      }
    }
  });
  if (CONFIG.comments.storage) {
    window.addEventListener('tabs:click', event => {
      if (!event.target.matches('.tabs-comment .tab-content .tab-pane')) return;
      let commentClass = event.target.classList[1];
      localStorage.setItem('comments_active', commentClass);
    });
  }
</script>

        </div>
          
  
  <div class="toggle sidebar-toggle">
    <span class="toggle-line toggle-line-first"></span>
    <span class="toggle-line toggle-line-middle"></span>
    <span class="toggle-line toggle-line-last"></span>
  </div>

  <aside class="sidebar">
    <div class="sidebar-inner">

      <ul class="sidebar-nav motion-element">
        <li class="sidebar-nav-toc">
          文章目录
        </li>
        <li class="sidebar-nav-overview">
          站点概览
        </li>
      </ul>

      <!--noindex-->
      <div class="post-toc-wrap sidebar-panel">
      </div>
      <!--/noindex-->

      <div class="site-overview-wrap sidebar-panel">
        <div class="site-author motion-element" itemprop="author" itemscope itemtype="http://schema.org/Person">
  <p class="site-author-name" itemprop="name">dz</p>
  <div class="site-description" itemprop="description"></div>
</div>
<div class="site-state-wrap motion-element">
  <nav class="site-state">
      <div class="site-state-item site-state-posts">
          <a href="/archives/">
        
          <span class="site-state-item-count">11</span>
          <span class="site-state-item-name">日志</span>
        </a>
      </div>
  </nav>
</div>



      </div>

    </div>
  </aside>
  <div id="sidebar-dimmer"></div>


      </div>
    </main>

    <footer class="footer">
      <div class="footer-inner">
        

        

<div class="copyright">
  
  &copy; 
  <span itemprop="copyrightYear">2024</span>
  <span class="with-love">
    <i class="fa fa-heart"></i>
  </span>
  <span class="author" itemprop="copyrightHolder">dz</span>
</div>
  <div class="powered-by">由 <a href="https://hexo.io/" class="theme-link" rel="noopener" target="_blank">Hexo</a> & <a href="https://muse.theme-next.org/" class="theme-link" rel="noopener" target="_blank">NexT.Muse</a> 强力驱动
  </div>

        








      </div>
    </footer>
  </div>

  
  <script src="/lib/anime.min.js"></script>
  <script src="/lib/velocity/velocity.min.js"></script>
  <script src="/lib/velocity/velocity.ui.min.js"></script>

<script src="/js/utils.js"></script>

<script src="/js/motion.js"></script>


<script src="/js/schemes/muse.js"></script>


<script src="/js/next-boot.js"></script>




  















  

  

</body>
</html>
